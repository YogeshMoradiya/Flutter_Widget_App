import 'package:demo_project/widgets/Padding_Widget.dart';
import 'package:demo_project/widgets/aboutdialog_widget.dart';
import 'package:demo_project/widgets/absorbpointer.dart';
import 'package:demo_project/widgets/alertdialog_widget.dart';
import 'package:demo_project/widgets/align_widget.dart';
import 'package:demo_project/widgets/animatedbuilder_widget.dart';
import 'package:demo_project/widgets/animatedcontainer_widget.dart';
import 'package:demo_project/widgets/animatedcrossfade_widget.dart';
import 'package:demo_project/widgets/animatedicon_widget.dart';
import 'package:demo_project/widgets/animatedopacity_widget.dart';
import 'package:demo_project/widgets/animatedpadding_widget.dart';
import 'package:demo_project/widgets/animatedpositioned_widget.dart';
import 'package:demo_project/widgets/animatedswitcher_widget.dart';
import 'package:demo_project/widgets/aspectratio_widget.dart';
import 'package:demo_project/widgets/autocomplete_widget.dart';
import 'package:demo_project/widgets/backdropfilter_widget.dart';
import 'package:demo_project/widgets/clip_r_rect.dart';
import 'package:demo_project/widgets/baseline_widget.dart';
import 'package:demo_project/widgets/checkboxlisttile_widget.dart';
import 'package:demo_project/widgets/clipoval_widget.dart';
import 'package:demo_project/widgets/clippath.dart';
import 'package:demo_project/widgets/colorfiltered_widget.dart';
import 'package:demo_project/widgets/constrainedbox_widget.dart';
import 'package:demo_project/widgets/container_widget.dart';
import 'package:demo_project/widgets/cupertinoactivityindicator_widget.dart';
import 'package:demo_project/widgets/custom_dropdownbutton.dart';
import 'package:demo_project/widgets/custopaint_widget.dart';
import 'package:demo_project/widgets/divider_widget.dart';
import 'package:demo_project/widgets/draggable_widget.dart';
import 'package:demo_project/widgets/draggablescrollable_widget.dart';
import 'package:demo_project/widgets/drawer_widget.dart';
import 'package:demo_project/widgets/dropdown_button_widget.dart';
import 'package:demo_project/widgets/dropdown_menu_widget.dart';
import 'package:demo_project/widgets/expanded_widget.dart';
import 'package:demo_project/widgets/expansionpanel_widget.dart';
import 'package:demo_project/widgets/fade_in_image_widget.dart';
import 'package:demo_project/widgets/fadetransition_widget.dart';
import 'package:demo_project/widgets/fittedbox_widget.dart';
import 'package:demo_project/widgets/floatingactionbutton_widget.dart';
import 'package:demo_project/widgets/flow_widget.dart';
import 'package:demo_project/widgets/flutter_slidable_widget.dart';
import 'package:demo_project/widgets/flutterlogo_widget.dart';
import 'package:demo_project/widgets/fractionallysizedbox_widget.dart';
import 'package:demo_project/widgets/futurebuilder_widget.dart';
import 'package:demo_project/widgets/gesture_detector_widget.dart';
import 'package:demo_project/widgets/gridview.dart';
import 'package:demo_project/widgets/heroanimation_widget.dart';
import 'package:demo_project/widgets/ignorepointer_widget.dart';
import 'package:demo_project/widgets/image_widget.dart';
import 'package:demo_project/widgets/imagefiltered_widget.dart';
import 'package:demo_project/widgets/indexedstack_widget.dart';
import 'package:demo_project/widgets/inkwell_widget.dart';
import 'package:demo_project/widgets/interactiveviewer_widget.dart';
import 'package:demo_project/widgets/layoutbuilder_widget.dart';
import 'package:demo_project/widgets/animatedList_widget.dart';
import 'package:demo_project/widgets/flexible_widget.dart';
import 'package:demo_project/widgets/limitedbox_widget.dart';
import 'package:demo_project/widgets/linear_gradient_widget.dart';
import 'package:demo_project/widgets/linearprogressindicator_widget.dart';
import 'package:demo_project/widgets/listtile_widget.dart';
import 'package:demo_project/widgets/listview_widget.dart';
import 'package:demo_project/widgets/listwheelscrollview.dart';
import 'package:demo_project/widgets/mediaquery_widdget.dart';
import 'package:demo_project/widgets/navigationbar_widget.dart';
import 'package:demo_project/widgets/navigationrail_widget.dart';
import 'package:demo_project/widgets/overlayportal_widget.dart';
import 'package:demo_project/widgets/pageview.dart';
import 'package:demo_project/widgets/physicalmodel_widget.dart';
import 'package:demo_project/widgets/placeholder_widget.dart';
import 'package:demo_project/widgets/positioned_widget.dart';
import 'package:demo_project/widgets/circularprogressindicator_widget.dart';
import 'package:demo_project/widgets/rawmagnifier_widget.dart';
import 'package:demo_project/widgets/refresh_indicator_widget.dart';
import 'package:demo_project/widgets/reorderablelistview_widget.dart';
import 'package:demo_project/widgets/richtext_widget.dart';
import 'package:demo_project/widgets/rotatedbox_widget.dart';
import 'package:demo_project/widgets/scaffold_messenger_widget.dart';
import 'package:demo_project/widgets/scrollbar_widget.dart';
import 'package:demo_project/widgets/segmented_button_widget.dart';
import 'package:demo_project/widgets/selectabletext_widget.dart';
import 'package:demo_project/widgets/shortcuts_widget.dart';
import 'package:demo_project/widgets/sliverappbar_widget.dart';
import 'package:demo_project/widgets/slivergrid_widget.dart';
import 'package:demo_project/widgets/sliverlist_widget.dart';
import 'package:demo_project/widgets/snackbar_widget.dart';
import 'package:demo_project/widgets/stack_widget.dart';
import 'package:demo_project/widgets/streambuilder.dart';
import 'package:demo_project/widgets/switchlisttile_widget.dart';
import 'package:demo_project/widgets/tabbar_widget.dart';
import 'package:demo_project/widgets/table_widget.dart';
import 'package:demo_project/widgets/tabpage_selector_widget.dart';
import 'package:demo_project/widgets/theme_widget.dart';
import 'package:demo_project/widgets/togglebuttons_widget.dart';
import 'package:demo_project/widgets/tooltip_widget.dart';
import 'package:demo_project/widgets/tweenanimationbuilder_widget.dart';
import 'package:demo_project/widgets/valuelistenablebuilder_widget.dart';
import 'package:demo_project/widgets/wrap_widget.dart';
import 'package:demo_project/widgets/dismissible.dart';
import 'package:demo_project/widgets/opaque_widget.dart';
import 'package:demo_project/widgets/safe_area_widget.dart';
import 'package:demo_project/widgets/sizedbox_widget.dart';
import 'package:demo_project/widgets/spacer_widget.dart';
import 'package:flutter/material.dart';
import 'package:shared_preferences/shared_preferences.dart';
// Assuming all the widget imports remain the same...

class HomeScreen extends StatefulWidget {
  const HomeScreen({super.key});

  @override
  State<HomeScreen> createState() => _HomeScreenState();
}

class _HomeScreenState extends State<HomeScreen> {
  SharedPreferences? prefs;
  List<MapEntry<String, Widget>> filteredWidgets = [];
  TextEditingController searchController = TextEditingController();

  // Original widget map
  final Map<String, Widget> widgetMap = {
    'Safe Area': const SafeAreaWidget(),
    'Expanded': const ExpandedWidget(),
    'Wrap': const WrapWidgets(),
    'Animated Container': const AnimatedContainerWidget(),
    'opacity widget': const OpaqueWidget(),
    'FutureBuilder': const FutureBuilderWidget(),
    'FadeTransition': const FadeTransitionWidget(),
    'FloatingAction Button': const FloatingActionButtonWidget(),
    'PageviewWidget': const PageviewWidget(),
    'TableWidget': const TableWidget(),
    'SliverAppBar Widget': const SliverAppBarWidget(),
    'SliverGridWidget': const SliverGridWidget(),
    'SliverListWidget': const SliverListWidget(),
    'Fadeinimage Widget': const FadeInImageWidget(),
    'ClipRRectWidget': const ClipRRectWidget(),
    'Heroanimation Widget': const HeroanimationWidget(),
    'CustomPaint Widget': const CustomPaintWidget(),
    'TooltipWidget': const TooltipWidget(),
    'FittedBoxWidget': const FittedBoxWidget(),
    'LayoutBuilder Widget': const LayoutBuilderWidget(),
    'AbsorbPointer Widget': const AbsorbPointerWidget(),
    'BackdropFilter Widget': const BackdropFilterWidget(),
    'AlignWidget': const AlignWidget(),
    'PositionedWidget': const PositionedWidget(),
    'AnimatedBuilderWidget': const AnimatedbuilderWidget(),
    'Dismissible Widget': const DismissibleWidget(),
    'SizedboxWidget': const SizedboxWidget(),
    'Animatedlist Widget': const AnimatedlistWidget(),
    'FlexibleWidget': const FlexibleWidget(),
    'Mediaquery Widget': const MediaqueryWidget(),
    'SpacerWidget': const SpacerWidget(),
    'Streambuilder Widget': const StreambuilderWidget(),
    'ValueListenable BuilderWidget': const ValueListenableBuilderWidget(),
    'Animatedicon Widget': const AnimatedIconWidget(),
    'Aspectratio Widget': const AspectratioWidget(),
    'Limitedbox Widget': const LimitedboxWidget(),
    'Placeholder Widget': const PlaceholderWidget(),
    'RichTextWidget': const RichTextWidget(),
    'Reorderable Listview Widget': const ReorderableListviewWidget(),
    'Animated Switcher Widget': const AnimatedSwitcherWidget(),
    'Animated Positioned Widget': const AnimatedPositionedWidget(),
    'AnimatedPaddingWidget': const AnimatedPaddingWidget(),
    'IndexedStack Widget': const IndexedStackWidget(),
    'Constrained Box Widget': const ConstrainedBoxWidget(),
    'StackWidget': const StackWidget(),
    'AnimatedOpacityWidget': const AnimatedOpacityWidget(),
    'FractionallySizedBoxWidget': const FractionallySizedBoxWidget(),
    'ListviewWidget': const ListviewWidget(),
    'ListTileWidget': const ListTileWidget(),
    'ContainerWidget': const ContainerWidget(),
    'SelectableTextWidget': const SelectableTextWidget(),
    'Alertdialog Widget': const AlertdialogWidget(),
    'AnimatedCross Fade Widget': const AnimatedCrossFadeWidget(),
    'Draggable Scrollable Widget': const DraggableScrollableWidget(),
    'ColorFiltered Widget': const ColorFilteredWidget(),
    'ToggleButtons Widget': const ToggleButtonsWidget(),
    'TweenAnimationBuilder Widget': const TweenAnimationBuilderWidget(),
    'ImageWidget': const ImageWidget(),
    'TabBarWidget': const TabBarWidget(),
    'DrawerWidget': const DrawerWidget(),
    'SnackBarWidget': const SnackBarWidget(),
    'ListWheel ScrollView Widget': const ListWheelScrollViewWidget(),
    'ClipPathWidget': const ClipPathWidget(),
    'Circularprogress Indicator Widget':
    const CircularprogressIndicatorWidget(),
    'LinearProgress Indicator Widget': const LinearProgressIndicatorWidget(),
    'DividerWidget': const DividerWidget(),
    'IgnorePointer Widget': const IgnorePointerWidget(),
    'CupertinoActivityIndicator Widget':
    const CupertinoActivityIndicatorWidget(),
    'ClipOvalWidget': const ClipOvalWidget(),
    'PaddingWidget': const PaddingWidget(),
    'CheckboxListTileWidget': const CheckboxListTileWidget(),
    'AboutDialog Widget': const AboutDialogWidget(),
    'InteractiveViewer Widget': const InteractiveViewerWidget(),
    'GridviewWidget': const GridviewWidget(),
    'SwitchListTile Widget': const SwitchListTileWidget(),
    'ImageFiltered Widget': const ImageFilteredWidget(),
    'PhysicalModel Widget': const PhysicalModelWidget(),
    'RotatedBox Widget': const RotatedBoxWidget(),
    'ExpansionPanel Widget': const ExpansionPanelWidget(),
    'ScrollbarWidget': const ScrollbarWidget(),
    'FlutterLogo Widget': const FlutterLogoWidget(),
    'RefreshIndicator Widget': const RefreshIndicatorWidget(),
    'FlowWidget': const FlowWidget(),
    'TabPageSelectorWidget': const TabPageSelectorWidget(),
    'ThemeWidget': const ThemeWidget(),
    'GestureDetectorWidget': const GestureDetectorWidget(),
    'BaselineWidget': const BaselineWidget(),
    'DropdownButtonWidget': const DropdownButtonWidget(),
    'Scaffold Messenger Widget': const ScaffoldMessengerWidget(),
    'NavigationRail Widget': const NavigationRailWidget(),
    'Autocomplete Widget': const AutocompleteWidget(),
    'LinearGradient Widget': const LinearGradientWidget(),
    'ShortcutsWidget': const ShortcutsWidget(),
    'BottomNavigationBar Widget': const NavigationBarWidget(),
    'RawMagnifier Widget': const RawMagnifierWidget(),
    'Draggable Widget': const DraggableWidget(),
    'OverlayPortal Widget': const OverlayPortalWidget(),
    'Dropdown Menu Widget': const DropdownMenuWidget(),
    'Segmented Button Widget': const SegmentedButtonWidget(),
    'Slidable Widget': const FlutterSlidableWidget(),
    'CustomDrop Down Button': const CustomDropDownButton(),
    'InkwellWidget': const InkwellWidget(),
  };

  @override
  void initState() {
    super.initState();
    _loadCounter();
    filteredWidgets = widgetMap.entries.toList(); // Initialize with all widgets
    searchController.addListener(() {
      filterWidgets();
    });
  }

  _loadCounter() async {
    prefs = await SharedPreferences.getInstance();
    setState(() {});  // Update the UI after loading preferences
  }

  void filterWidgets() {
    String query = searchController.text.toLowerCase();
    setState(() {
      if (query.isEmpty) {
        // If search query is empty, show all widgets
        filteredWidgets = widgetMap.entries.toList();
      } else {
        // Filter the widgetMap based on the query
        filteredWidgets = widgetMap.entries.where((entry) {
          return entry.key.toLowerCase().contains(query);
        }).toList();
      }
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      appBar: AppBar(
        centerTitle: true,
        backgroundColor: Colors.red,
        title: const Text(
          'All Files',
          style: TextStyle(
            color: Colors.white,
            fontWeight: FontWeight.bold,
          ),
        ),
      ),
      body: Padding(
        padding: const EdgeInsets.symmetric(vertical: 20, horizontal: 15),
        child: Column(
          children: [
            // Search bar
            Padding(
              padding: const EdgeInsets.only(bottom: 10),
              child: TextField(
                controller: searchController,
                decoration: InputDecoration(
                  hintText: 'Search...',
                  border: OutlineInputBorder(
                    borderRadius: BorderRadius.circular(10),
                    borderSide: const BorderSide(),
                  ),
                ),
              ),
            ),
            // Grid view for filtered widgets
            Expanded(
              child: GridView.count(
                padding: const EdgeInsets.only(top: 10),
                crossAxisSpacing: 10,
                mainAxisSpacing: 20,
                crossAxisCount: 3,
                children: filteredWidgets.map(
                      (e) {
                    int count;
                    return InkWell(
                      onTap: () async {
                        count = prefs?.getInt(e.key) ?? 0;
                        prefs?.setInt(e.key, count + 1);
                        await Navigator.push(
                          context,
                          MaterialPageRoute(
                            builder: (context) {
                              return e.value;
                            },
                          ),
                        );
                        setState(() {});
                      },
                      child: Stack(
                        clipBehavior: Clip.none,
                        children: [
                          Container(
                            decoration: BoxDecoration(
                              color: Colors.blue,
                              borderRadius: BorderRadius.circular(15),
                            ),
                            height: 130,
                            width: 130,
                            alignment: Alignment.center,
                            child: Text(
                              e.key,
                              style: const TextStyle(
                                color: Colors.white,
                                fontWeight: FontWeight.bold,
                              ),
                              textAlign: TextAlign.center,
                            ),
                          ),
                          Positioned(
                            top: -10,
                            left: 7,
                            child: CircleAvatar(
                              radius: 13,
                              backgroundColor: Colors.red,
                              child: Text(
                                '${prefs?.getInt(e.key) ?? 0}',
                                style: const TextStyle(
                                  color: Colors.white,
                                  fontWeight: FontWeight.bold,
                                ),
                              ),
                            ),
                          ),
                        ],
                      ),
                    );
                  },
                ).toList(),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
